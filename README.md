# :clipboard: To Do 앱 서버 만들기

<strong>할 일 목록을 작성해보세요</strong>

스프링 부트를 기반으로 REST API를 만드는 과제입니다.

<br/>

# :memo: 주특기 복습, 개선 과제

## :books: 복습 과제 요구 사항과 그에 따라 제작한 세부 내용

- 회원 가입 API
    - 요구 사항
      - 닉네임, 비밀번호, 비밀번호 확인을 **request**에서 전달받기
      - 닉네임은 최소 3자 이상, 알파벳 대소문자(a-z, A-Z), 숫자(0~9)로 구성하기
      - 비밀번호는 최소 4자 이상이며, 닉네임과 같은 값이 포함된 경우 회원가입에 실패로 만들기
      - 비밀번호 확인은 비밀번호와 정확하게 일치하기
      - 데이터베이스에 존재하는 닉네임을 입력한 채 회원가입 버튼을 누른 경우 "중복된 닉네임입니다." 라는 에러메세지를 **response**에 포함하기
      - 회원 가입 버튼을 누르기 전, 같은 닉네임이 존재하는지 "확인" 버튼을 눌러 먼저 유효성 검증부터 할 수 있도록 해보기
      - (챌린지 과제) 데이터베이스에 비밀번호를 평문으로 저장하는 것이 아닌, 단방향 암호화 알고리즘을 이용하여 암호화 해서 저장하도록 하기

  - 제작 사항
    - SignUpRequest에서 닉네임과 비밀번호, 비밀번호 확인을 전달받습니다.
    - 닉네임은 정규표현식을 이용해 알파벳 대소문자와 숫자만 입력할 수 있고, 3~30자로만 입력할 수 있도록 제한했습니다.
    - 비밀번호도 정규표현식을 이용해 알파벳 대소문자, 숫자와 특수문자('!@#$?&%^*+=-')만 입력할 수 있고 4~20자로만 입력할 수 있도록 제한했습니다.
    - 비밀번호 확인과 비밀번호가 일치하지 않으면 회원가입이 진행되지 않습니다.
    - 중복된 닉네임이 있는 경우 "중복된 닉네임입니다."라는 에러메시지가 ResponseBody에 담겨 보내집니다.
    - '/users'라는 URI에 파라미터로 닉네임을 넣어 Get 요청을 보내면 중복된 닉네임인지 체크할 수 있습니다. 중복된 닉네임인 경우 "이미 존재하는 닉네임입니다"라는 문구가, 사용가능한 닉네임이면 "사용가능한 닉네임입니다"라는 문구가 ResponseBody로 전달됩니다.
    - 비밀번호를 BCryptPasswordEncoder()를 이용하여 암호화하여 저장하도록 만들었습니다.
 
- 로그인 API
  - 요구 사항
    - 닉네임, 비밀번호를 **request**에서 전달받기
    - 로그인 버튼을 누른 경우 닉네임과 비밀번호가 데이터베이스에 등록됐는지 확인한 뒤, 하나라도 맞지 않는 정보가 있다면 "닉네임 또는 패스워드를 확인해주세요."라는 에러 메세지를 **response**에 포함하기
    - 로그인 성공 시, 로그인에 성공한 유저의 정보를 JWT를 활용하여 클라이언트에게 Cookie로 전달하기
   
  - 제작 사항
    - 닉네임과 비밀번호를 RequestBody로 전달받습니다.
    - 로그인 버튼을 누른 경우 없는 닉네임을 입력하거나, 비밀번호가 다른 경우 "닉네임 또는 패스워드를 확인해주세요"라는 메시지가 반환됩니다.
    - 로그인에 성공하면 요구사항에 따라 토큰을 HttpOnly 쿠키를 이용하여 전달합니다. ResponseBody로도 토큰을 동시에 내보내도록 만들었습니다.(과제에는 두 개 다 해두었습니다만 실제로는 상황에 따라 둘 중 하나를 선택하게 될 것 같습니다.)
 
- 전체 게시글 목록 조회 API
  - 요구 사항
    - 제목, 작성자명(nickname), 작성 날짜를 조회하기
    - 작성 날짜 기준으로 내림차순 정렬하기

  - 제작 사항
    - 전체 게시글 조회시 작성 날짜 기준으로 내림차순으로 정렬되며, 제목, 작성자 이름(저는 nickname(닉네임, 아이디)과 이름(name) 중에서 name을 반환하도록 만들었습니다.), 작성 시간이 반환됩니다.
 
- 게시글 작성 API
  - 요구 사항 
    - 토큰을 검사하여, 유효한 토큰일 경우에만 게시글 작성 가능
    - 제목(500자 까지 입력 가능), 작성 내용을 입력하기(5000자 까지 입력 가능)
   
  - 제작 사항
    - 토큰을 검사하여 유효한 토큰일 경우에만 게시글 작성이 가능합니다. (로그인한 유저만 게시글 작성이 가능합니다.)
    - 제목은 1-500자 사이의 값을 입력해야 합니다. 본문은 1-5000 자 사이의 값을 입력해야 합니다.
 
- 게시글 조회 API
  - 요구 사항
    - 제목, 작성자명(nickname), 작성 날짜, 작성 내용을 조회하기
   
  - 제작 사항
    - 게시글 단건 조회를 하면 제목, 작성자 이름(name), 작성 시간 , 본문이 조회됩니다.

- 게시글 수정 API
  - 요구 사항 
    - 토큰을 검사하여, 해당 사용자가 작성한 게시글만 수정 가능
   
  - 제작 사항
    - 토큰을 검사하여, 작성자 본인만이 본인의 게시글을 수정 가능하도록 만들었습니다.  
 
- 게시글 삭제 API
  - 요구 사항 
    - 토큰을 검사하여, 해당 사용자가 작성한 게시글만 삭제 가능
     
  - 제작 사항
    - 토큰을 검사하여, 작성자 본인만이 본인의 게시글을 삭제 가능하도록 만들었습니다.  
 
- 댓글 작성 API
  - 요구 사항
    - 게시글과 연관 관계를 가진 댓글 테이블 추가
    - 토큰을 검사하여, 유효한 토큰일 경우에만 게시글 작성 가능
    - 작성 내용을 입력하기
    - 게시글에 대한 좋아요

  - 제작 사항
    - 게시글 아래에 댓글을 달 수 있습니다.
    - 토큰을 검사하여 유효한 토큰일 경우에만 댓글 작성이 가능합니다. (로그인한 유저만 댓글 작성이 가능합니다.)
    - 게시글에 대한 좋아요 기능을 만들었습니다.
 
- 게시글과 댓글 목록 조회 API, 댓글 수정/삭제 API
  - 요구 사항 
    - 댓글 목록 조회
        - (챌린지 과제) 전체 조회가 아닌 페이징 조회를 할 수 있도록 해보기
    - 게시글 조회 API 호출시 해당 게시글의 댓글 목록도 응답
    - 토큰을 검사하여, 해당 사용자가 작성한 댓글만 수정/삭제 가능
   
  - 제작 사항
    - 페이징 조회의 경우는 개선 과제의 QueryDsl 과제 부분에서 수행하였습니다.
    - 게시글 단건을 조회하면 댓글 목록이 같이 조회됩니다.
    - 토큰을 검사하여, 작성자 본인만이 본인의 댓글만 수정, 삭제가 가능하도록 만들었습니다.  

## :books: 개선 과제 요구 사항과 그에 따라 제작한 세부 내용 

- Controller Advice 로 예외 공통화 처리하기
  - 요구 사항 
    - @RestControllerAdvice 를 사용해서 모든 RestController 의 예외를 공통화해서 처리해주세요.
  - 제작 사항
    - @RestControllerAdvice를 사용해서 GlobalExceptionHandler 클래스를 만들어 예외를 공통화하여 처리하였습니다.
   
- CustomException 정의
  - 요구 사항 
    - 애플리케이션에서 발생하는 예외상황은 정말 다양한데 기존에 존재하는 Exception 만 가지고 구현하려니 힘들었을겁니다.
    - 이제는 `RuntimeException`을 상속 받아서 CustomException 을 상황에 맞게 만들어보세요.
   
  - 제작 사항
    - CustomException을 직접 만들어보았고 GlobalExceptionhandler에서 한 번에 처리하도록 만들었습니다.  
 
- Service 인터페이스와 구현체 분리하여 추상화 하기
  - 요구 사항 
    - Service 클래스를 인터페이스와 구현체로 분리하고 인터페이스 메서드에 주석을 친절하게 달아주세요

  - 제작 사항
    - Service 클래스를 Service 인터페이스와 ServiceImpl 구현체로 분리하여 코드를 작성하였습니다.
    - Service 구현체를 바꿔 끼우더라도 잘 작동하는 변경에 유연한 구조로 만들어 볼 수 있었습니다.
 
- Spring AOP 적용
  - 요구 사항
    - Spring AOP 를 사용하여 부가기능을 추가해보세요.
   
  - 제작 사항
    - 적용할만한 적절한 AOP가 떠오르지 않아 실행시간을 측정하는 StopWatch를 사용했습니다.
    - 빈 DTO를 반환하지 않도록 함수를 살짝 수정했습니다.  
 
- QueryDSL 을 사용하여 검색 기능 만들기
  - 요구 사항
    - QueryDSL 의 jpaQueryFactory 를 사용해서 검색기능을 만들어주세요

  - 제작 사항
    - "/todos/search"에 GET 요청을 다양한 쿼리 파라미터와 함께 보낼 수 있는 검색 기능을 만들었습니다.
    - 검색 조건은 아래와 같습니다.
    - 제목: 검색할 제목을 입력하면 해당 검색어가 포함된 제목을 가진 Todo들이 반환됩니다.
    - 작성자 이름: 작성자 이름을 입력하면 작성자 이름이 정확히 일치하는 Todo들이 반환됩니다.
    - 완료 여부: 완료 여부를 true 또는 false로 입력해주면 완료가 된 Todo 또는 완료가 되지 않은 Todo들만 반환됩니다.
    - n일전 작성된 Todo: 날짜를 숫자로 입력해주면 현재 시점으로부터 n일전 이내에 작성된 Todo만을 조회할 수 있습니다.
    - Pageable 객체에 정렬 조건을 넣어주면 작성일 기준 오름차순 또는 내림차순, 제목 기준 오름차순 또는 내림차순으로 조회할 수 있습니다.
 
- Pageable 을 사용하여 페이징 및 정렬 기능 만들기
  - 요구 사항
    - Pageable 을 사용해서 원하는 페이지 사이즈만큼만 조회 해주세요
   
  - 제작 사항
    - 전체 Todo 조회와 검색 조회의 경우 Pageable을 사용해서 원하는 페이지 사이즈만큼만 조회할 수 있도록 만들었습니다.
    - fetch join을 사용하고 있기 때문에 batch size를 지정해주었습니다.

- 다양한 조건을 동적 쿼리로 처리하기
  - 제작 사항
    - 위의 검색 기능에서 다양한 조건을 동적 쿼리로 처리하는 기능을 만들었습니다.
    - 제목, 작성자 이름, 완료 여부, n일전과 같은 조건들 중 하나만 입력하거나 여러개 입력했을 때 입력해준 조건들이 모두 적용되어 검색된 결과를 반환합니다. 

- Controller 테스트 코드 작성하기
  - 요구 사항 
    - MockMvc 를 사용해서 Controller 테스트 코드를 작성해주세요

  - 제작 사항
    - 시간이 부족하여 UserController 하나에 대해서만 간단하게 테스트 코드를 작성하였습니다.
    - 상황에 따라 제대로 된 상태 코드와 메시지를 반환하는지를 테스트 할 수 있습니다.
 
- Service 테스트 코드 작성하기
  - 요구 사항 
    - Mockito 을 사용하여 Service 테스트 코드를 작성해주세요
   
  - 제작 사항
    - UserService에 대해서만 간단하게 테스트 코드를 작성해보았습니다.
    - 시간이 없어서 2개의 메서드에 대해서만 테스트를 작성해보았습니다.
 
- Repository 테스트 코드 작성하기
  - 요구 사항 
    - @DataJpaTest 를 사용해서 Repository 테스트 코드를 작성해주세요
   
  - 제작 사항
    - Data JPA만을 사용한 다른 Repository보다 QueryDsl을 이용한 TodoRepository를 테스트하는 것이 가장 중요하다고 생각해 TodoRepository에 대해서만 테스트를 작성해보았습니다.
    - 예상치 못한 다양한 문제가 생겨서 어려움이 있었습니다. 현재 모두 잘 작동되도록 고쳤지만 이게 옳은 방향인지에 대해서는 여전히 의문을 가지고 있습니다.
    - 현재 하나의 테스트가 너무 많은 것들을 테스트하고 있다는 문제가 있는 것 같습니다. 다음번에는 하나의 테스트가 하나의 사항에 대해서만 테스트하도록 잘 작성해봐야겠습니다.
   
- AWS S3, EC2 이용해 이미지 저장, 배포 해보기
  - 프로필 이미지 저장 기능을 염두해두고 작성했는데 현재 이미지 업로드가 구현되지 못한 상태입니다.
  - 테스트 코드 작성이 생각보다 훨씬 오래 걸려서 하지 못했습니다.  
 
<br/>

<strong>Use Case Diagram</strong>

![Picture](/readme_assets/use_case_diagram.png)

<br/>

<strong>API 명세서</strong>

|Command|Method|성공 Status Code|URI|
|---|---|:---:|---|
|User 조회|`GET`|`200`|/users/{userId}|
|User 프로필 사진 변경|`PUT`|`200`|/users/{userId}|
|회원가입|`POST`|`201`|/signup|
|로그인|`POST`|`200`|/login|
|닉네임 중복 확인|`GET`|`200`|/users|
|Todo 목록 조회|`GET`|`200`|/todos|
|Todo 단건 조회|`GET`|`200`|/todos/{todoId}|
|Todo 작성|`POST`|`201`|/todos|
|Todo 할일 완료/진행중|`PATCH`|`200`|/todos/{todoId}|
|Todo 수정|`PUT`|`200`|/todos/{todoId}|
|Todo 삭제|`DELETE`|`204`|/todos/{todoId}|
|Todo 검색 조회|`GET`|`200`|/todos/search|
|Todo 좋아요|`POST`|`200`|/todos/{todoId}/thumb-up|
|Todo 좋아요 취소|`DELETE`|`200`|/todos/{todoId}/thumb-up|
|Comment 단건 조회|`GET`|`200`|/todos/{todoId}/comments/{commentId}|
|Comment 작성|`POST`|`201`|/todos/{todoId}/comments|
|Comment 수정|`PUT`|`200`|/todos/{todoId}/comments/{commentId}|
|Comment 삭제|`DELETE`|`204`|/todos/{todoId}/comments/{commentId}|


<br/>

<strong>ERD</strong>

![Picture](/readme_assets/erd.png)

<br/>


## :pushpin: 환경설정

|           |                                                             Tool & Version                                                             |
|:---------:|:--------------------------------------------------------------------------------------------------------------------------------------:|
| Language  |              <img src="https://img.shields.io/badge/Kotlin-ver 1.9.24-7F52FF?style=flat-squre&logo=Kotlin&logoColor=white"/>              |
|    IDE    |            <img src="https://img.shields.io/badge/Intellij%20IDEA-000000?style=flat-squre&logo=intellijidea&logoColor=white"/>            |
|    SDK    | <img src="https://img.shields.io/badge/Eclipse%20Temurin-ver 17.0.11-FF1464?style=flat-squre&logo=eclipseadoptium&logoColor=white"/> | 
| Framework |       <img src="https://img.shields.io/badge/Spring%20Boot-ver 3.2.7-6DB33F?style=flat-squre&logo=springboot&logoColor=white"/>        |
|    JWT    |         <img src="https://img.shields.io/badge/jjwt-ver 0.12.5-000000?style=flat-square&logo=jsonwebtokens&logoColor=white"/>          |
